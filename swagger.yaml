openapi: 3.0.0
info:
  title: AI Assistant Backend - Sua API de Produtividade
  description: |
    Documenta√ß√£o completa da API do seu Assistente Pessoal Inteligente.
    
    A maioria das rotas requer autentica√ß√£o **Bearer Token** (JWT), obtido no endpoint `/auth/login`.

    ### üß† Vis√£o Geral dos M√≥dulos
    * **Auth/Users**: Cadastro, Login e Configura√ß√µes Pessoais.
    * **Finance/Investments**: Controle financeiro, transa√ß√µes e investimentos.
    * **Study**: Cadastro de mat√©rias e gerenciamento de planos de estudo.
    * **Market/Todo/Goals/Ideas**: Listas de compras, tarefas e metas.
    * **Gym**: Perfil de sa√∫de e planos de treino.
    * **Vault**: Cofre de senhas criptografadas.
    * **Google (Externo)**: Agenda, E-mail, Docs e Sheets.
  version: 1.0.0

servers:
  - url: http://localhost:8080
    description: Servidor de Desenvolvimento Local

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

security:
  - bearerAuth: []

paths:
# =================================================================
# 1. AUTENTICA√á√ÉO E USU√ÅRIOS
# =================================================================
  /auth/login:
    post:
      tags:
        - Autentica√ß√£o
      summary: Login do Usu√°rio (Retorna JWT)
      description: Gera o Access Token (15m) e Refresh Token.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  example: "user@exemplo.com"
                password:
                  type: string
                  example: "sua-senha-secreta"
      responses:
        '200':
          description: Sucesso (Tokens e Perfil do Usu√°rio)
        '401':
          description: Credenciais inv√°lidas.
  # --- [INICIO DO BLOCO NOVO] ---
  /auth/refresh:
    post:
      tags:
        - Autentica√ß√£o
      summary: Renovar Token de Acesso
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refreshToken:
                  type: string
      responses:
        '200':
          description: Novos tokens gerados.

  /auth/logout:
    post:
      tags:
        - Autentica√ß√£o
      summary: Logout (Revogar Refresh Token)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refreshToken:
                  type: string
      responses:
        '200':
          description: Desconectado com sucesso.
  # --- [FIM DO BLOCO NOVO] ---
          
  /users/create:
    post:
      tags:
        - Usu√°rios e Config
      summary: Cadastrar Novo Usu√°rio
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                full_name:
                  type: string
                email:
                  type: string
                password:
                  type: string
                country_code:
                  type: string
                  example: "55"
                area_code:
                  type: string
                  example: "11"
                phone_number:
                  type: string
                  example: "999999999"
      responses:
        '201':
          description: Usu√°rio criado.
  /users/me:
    get:
      tags:
        - Usu√°rios e Config
      summary: Obter perfil do usu√°rio logado
      responses:
        '200':
          description: Dados do usu√°rio e configura√ß√µes.
          
  /users/config:
    patch:
      tags:
        - Usu√°rios e Config
      summary: Atualizar Configura√ß√µes do Bot e Usu√°rio
      description: Atualiza apelidos, personalidade do Agente, e op√ß√£o de √°udio.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userNickname:
                  type: string
                agentPersonality:
                  type: array
                  items:
                    type: string
                ai_send_audio:
                  type: boolean
  /users/phone:
    put:
      tags:
        - Usu√°rios e Config
      summary: Atualizar n√∫mero de telefone
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                country_code:
                  type: string
                area_code:
                  type: string
                phone_number:
                  type: string
      responses:
        '200':
          description: Telefone atualizado.

# =================================================================
# 2. FINAN√áAS E INVESTIMENTOS
# =================================================================
  /finance/transaction:
    post:
      tags:
        - Finan√ßas
      summary: Adicionar Transa√ß√£o (Gasto ou Ganho)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                amount:
                  type: number
                  example: 55.50
                type:
                  type: string
                  enum: [income, expense]
                category:
                  type: string
                  example: "Alimenta√ß√£o"
                date:
                  type: string
                  format: date-time
                  example: "2025-12-10T10:00:00Z"
      responses:
        '200':
          description: Sucesso ao registrar.
          
  /finance/recurring:
    post:
      tags:
        - Finan√ßas
      summary: Adicionar Transa√ß√£o Recorrente (Gasto/Ganho Fixo)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                amount:
                  type: number
                type:
                  type: string
                  enum: [income, expense]
                day_of_month:
                  type: integer
                  example: 5
                category:
                  type: string
                  example: "Internet"
                description:
                  type: string
                  example: "Vivo Fibra"
      responses:
        '201':
          description: Recorr√™ncia cadastrada.
    get:
      tags:
        - Finan√ßas
      summary: Listar contas fixas cadastradas
      responses:
        '200':
          description: Lista de recorr√™ncias ativas.
          
  /finance/report:
    get:
      tags:
        - Finan√ßas
      summary: Obter Relat√≥rio Financeiro e Saldo Atual
      responses:
        '200':
          description: Retorna resumo do m√™s e saldo atual.
  # --- [INICIO DO BLOCO NOVO] ---
  /finance/settings:
    post:
      tags:
        - Finan√ßas
      summary: Configurar Saldo e Renda
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                income:
                  type: number
                limit:
                  type: number
                balance:
                  type: number
                currency:
                  type: string
      responses:
        '200':
          description: Configura√ß√µes salvas.

  /finance/transactions:
    get:
      tags:
        - Finan√ßas
      summary: Listar Extrato (√öltimas transa√ß√µes)
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            example: 20
      responses:
        '200':
          description: Lista de transa√ß√µes.

  /finance/search:
    get:
      tags:
        - Finan√ßas
      summary: Buscar Transa√ß√µes com Filtros
      parameters:
        - name: category
          in: query
          schema: { type: string }
        - name: description
          in: query
          schema: { type: string }
      responses:
        '200':
          description: Resultado da busca.
  # --- [FIM DO BLOCO NOVO] ---

  /investments:
    post:
      tags:
        - Investimentos
      summary: Adicionar novo aporte
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                asset_name:
                  type: string
                  example: "Tesouro IPCA"
                amount:
                  type: number
                  example: 500
      responses:
        '201':
          description: Aporte registrado.
    get:
      tags:
        - Investimentos
      summary: Listar carteira de investimentos consolidada
      responses:
        '200':
          description: Retorna resumo da carteira por ativo.
  # =================================================================
# IDEIAS E NOTAS
# =================================================================
  /ideas:
    get:
      tags:
        - Ideias
      summary: Listar todas as ideias
      responses:
        '200':
          description: Lista de ideias.
    post:
      tags:
        - Ideias
      summary: Criar nova ideia
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: string
                tags:
                  type: array
                  items:
                    type: string
      responses:
        '201':
          description: Ideia criada.

  /ideas/{ideaId}:
    put:
      tags:
        - Ideias
      summary: Atualizar ideia
      parameters:
        - name: ideaId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                content: { type: string }
                tags: { type: array, items: { type: string } }
      responses:
        '200':
          description: Ideia atualizada.
    delete:
      tags:
        - Ideias
      summary: Deletar ideia espec√≠fica
      parameters:
        - name: ideaId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Ideia removida.

  /ideas/clear:
    delete:
      tags:
        - Ideias
      summary: Apagar TODAS as ideias
      responses:
        '200':
          description: Todas as ideias foram removidas.

# =================================================================
# 3. ESTUDOS (NOVO)
# =================================================================
  /study/subjects:
    get:
      tags:
        - Estudos
      summary: Listar todas as mat√©rias cadastradas
      responses:
        '200':
          description: Lista de mat√©rias.
    post:
      tags:
        - Estudos
      summary: Cadastrar nova mat√©ria de estudo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: "C√°lculo 1"
                category:
                  type: string
                  example: "Faculdade"
      responses:
        '201':
          description: Mat√©ria criada.
  /study/plans/latest:
    get:
      tags:
        - Estudos
      summary: Obter o plano de estudo ativo
      description: Retorna o plano que est√° em andamento ou em rascunho.
      responses:
        '200':
          description: Detalhes do plano e passos atuais.
        '404':
          description: Nenhum plano ativo encontrado.

  /study/plans/draft:
    post:
      tags:
        - Estudos
      summary: Iniciar um rascunho de plano de estudo
      description: Cria um novo rascunho (Draft) com o conte√∫do a ser estudado, arquivando planos anteriores.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                subjectId:
                  type: string
                  format: uuid
                  example: "a1b2c3d4-..."
                contentToStudy:
                  type: string
                  example: "Revisar Limites, Derivadas e Regra da Cadeia."
      responses:
        '201':
          description: Rascunho criado.

  /study/plans/{planId}/advance:
    patch:
      tags:
        - Estudos
      summary: Avan√ßar para o pr√≥ximo passo do plano ativo
      parameters:
        - name: planId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Avan√ßado para o pr√≥ximo passo.
        '404':
          description: Plano n√£o encontrado ou j√° conclu√≠do.
          
# =================================================================
# 4. LISTAS, TAREFAS E METAS
# =================================================================
  /todo:
    post:
      tags:
        - Tarefas (To-Do)
      summary: Criar Nova Tarefa
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                task:
                  type: string
                  example: "Comprar leite e p√£o"
                deadline:
                  type: string
                  format: date-time
                  example: "2025-12-10T18:00:00Z"
      responses:
        '201':
          description: Tarefa criada.
    get:
      tags:
        - Tarefas (To-Do)
      summary: Listar Tarefas
      parameters:
        - name: completed
          in: query
          required: false
          schema:
            type: boolean
      responses:
        '200':
          description: Lista de tarefas.
          
  /todo/{id}:
    patch:
      tags:
        - Tarefas (To-Do)
      summary: Marcar tarefa como conclu√≠da/pendente
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                done:
                  type: boolean
                  example: true
      responses:
        '200':
          description: Status atualizado.
    delete:
      tags:
        - Tarefas (To-Do)
      summary: Apagar Tarefa
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Tarefa deletada.
          
  /market-list:
    post:
      tags:
        - Lista de Compras
      summary: Adicionar m√∫ltiplos itens √† lista
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                items:
                  type: array
                  items:
                    type: object
                    properties:
                      itemName:
                        type: string
                      quantity:
                        type: number
                  example: [{"itemName": "P√£o de forma", "quantity": 1}]
      responses:
        '200':
          description: Itens adicionados/atualizados.
    get:
      tags:
        - Lista de Compras
      summary: Ver lista de compras
      responses:
        '200':
          description: Itens da lista.
    delete:
      tags:
        - Lista de Compras
      summary: Limpar lista inteira
      responses:
        '200':
          description: Lista limpa.

  # --- [INICIO DO BLOCO NOVO PARA ITEM ESPEC√çFICO] ---
  /market-list/{itemId}:
    put:
      tags:
        - Lista de Compras
      summary: Atualizar quantidade
      parameters:
        - name: itemId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                new_quantity:
                  type: number
      responses:
        '200':
          description: Quantidade atualizada.
    delete:
      tags:
        - Lista de Compras
      summary: Remover item espec√≠fico
      parameters:
        - name: itemId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Item removido.
  # --- [FIM DO BLOCO NOVO] ---

  /goals:
    get:
      tags:
        - Metas (Goals)
      summary: Listar todas as metas do usu√°rio
      responses:
        '200':
          description: Lista de metas com progresso.
    post:
      tags:
        - Metas (Goals)
      summary: Criar Nova Meta
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                goal_name:
                  type: string
                  example: "Reserva de Emerg√™ncia"
                target_amount:
                  type: number
                  example: 10000
                metric_unit:
                  type: string
                  example: "R$"
                deadline:
                  type: string
                  format: date
                  example: "2026-12-31"
      responses:
        '201':
          description: Meta criada.
  # --- [INICIO DO BLOCO NOVO] ---
  /goals/{goalId}:
    put:
      tags:
        - Metas (Goals)
      summary: Editar detalhes da meta
      parameters:
        - name: goalId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                goal_name: { type: string }
                target_amount: { type: number }
                deadline: { type: string, format: date }
      responses:
        '200':
          description: Meta atualizada.
    delete:
      tags:
        - Metas (Goals)
      summary: Excluir meta
      parameters:
        - name: goalId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Meta exclu√≠da.
  # --- [FIM DO BLOCO NOVO] ---
          
  /goals/progress/{goalId}:
    patch:
      tags:
        - Metas (Goals)
      summary: Atualizar Progresso da Meta
      parameters:
        - name: goalId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                amount:
                  type: number
                  example: 500
      responses:
        '200':
          description: Progresso atualizado.

# =================================================================
# 5. COFRE E GYM
# =================================================================
  /vault:
    post:
      tags:
        - Cofre (Vault)
      summary: Salvar ou Atualizar Anota√ß√£o Criptografada
      description: Dados salvos em 'content' s√£o criptografados no banco.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  example: "Login Netflix"
                category:
                  type: string
                  example: "login"
                content:
                  type: object
                  example: { "user": "caiua@email.com", "pass": "secreta123" }
      responses:
        '201':
          description: Anota√ß√£o salva/atualizada.
    get:
      tags:
        - Cofre (Vault)
      summary: Buscar Anota√ß√µes (T√≠tulo ou Categoria)
      parameters:
        - name: query
          in: query
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Lista de anota√ß√µes descriptografadas.
  # --- [INICIO DO BLOCO NOVO] ---
  /vault/{annotationId}:
    delete:
      tags:
        - Cofre (Vault)
      summary: Apagar anota√ß√£o
      parameters:
        - name: annotationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Registro deletado.
  # --- [FIM DO BLOCO NOVO] ---
          
  /gym/profile:
    post:
      tags:
        - Academia (Gym)
      summary: Atualizar Perfil de Sa√∫de/Treino
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                weight:
                  type: number
                  example: 85.5
                height:
                  type: number
                  example: 1.78
                goal:
                  type: string
                  example: "Hipertrofia"
      responses:
        '200':
          description: Perfil atualizado.
    get:
      tags:
        - Academia (Gym)
      summary: Ler Perfil de Sa√∫de
      responses:
        '200':
          description: Dados do perfil.
          
  /gym/plan:
    get:
      tags:
        - Academia (Gym)
      summary: Obter Plano de Treino Semanal Completo
      responses:
        '200':
          description: Retorna os treinos salvos por dia da semana.
    post:
      tags:
        - Academia (Gym)
      summary: Salvar dia de treino manualmente
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                day: { type: string, example: "monday" }
                focus: { type: string }
                exercises: { type: array, items: { type: string } }
      responses:
        '200':
          description: Treino salvo.
          
# =================================================================
# 6. INTEGRA√á√ÉO GOOGLE
# =================================================================
  /gmail/list:
    get:
      tags:
        - Google (Gmail)
      summary: Listar E-mails
      parameters:
        - name: query
          in: query
          required: false
          schema:
            type: string
            example: "is:unread newer_than:7d"
      responses:
        '200':
          description: Retorna lista de snippets de e-mails.

  /calendar/create:
    post:
      tags:
        - Google (Calendar)
      summary: Criar Novo Evento na Agenda
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                summary:
                  type: string
                start:
                  type: string
                  format: date-time
                end:
                  type: string
                  format: date-time
      responses:
        '200':
          description: Evento criado e link do Meet retornado.
  
  # --- [NOVA ROTA DE BUSCA COM PAGINA√á√ÉO] ---
  /calendar/search:
    get:
      tags:
        - Google (Calendar)
      summary: Pesquisar eventos na agenda (Filtros e Pagina√ß√£o)
      description: |
        Busca eventos sincronizados no banco de dados local com suporte a filtros de data, busca textual e pagina√ß√£o.
        Retorna links do evento e do Google Meet se dispon√≠veis.
      parameters:
        - name: page
          in: query
          description: N√∫mero da p√°gina (padr√£o 1)
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          description: Itens por p√°gina (padr√£o 10)
          schema:
            type: integer
            default: 10
        - name: q
          in: query
          description: Termo de busca (t√≠tulo ou descri√ß√£o)
          schema:
            type: string
        - name: fixedDate
          in: query
          description: Data espec√≠fica (YYYY-MM-DD). Priorit√°rio sobre start/end.
          schema:
            type: string
            format: date
        - name: startDate
          in: query
          description: Data inicial do intervalo (ISO)
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          description: Data final do intervalo (ISO)
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Resultados da busca paginados.

  /calendar/check:
    post:
      tags:
        - Google (Calendar)
      summary: Verificar disponibilidade
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                start: { type: string, format: date-time }
                end: { type: string, format: date-time }
      responses:
        '200': { description: Status de ocupado/livre }
  /calendar/list:
    post:
      tags:
        - Google (Calendar)
      summary: Listar pr√≥ximos eventos
      description: Retorna os pr√≥ximos eventos da agenda do usu√°rio.
      responses:
        '200':
          description: Lista de eventos encontrada.

  /calendar/delete:
    post:
      tags:
        - Google (Calendar)
      summary: Cancelar/Deletar um evento
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                event_id:
                  type: string
                  description: O ID do evento no Google Calendar
      responses:
        '200':
          description: Evento cancelado com sucesso.

  /gmail/read/{messageId}:
    get:
      tags:
        - Google (Gmail)
      summary: Ler conte√∫do de um e-mail
      parameters:
        - name: messageId
          in: path
          required: true
          schema: { type: string }
      responses:
        '200': { description: Corpo do e-mail }

  /drive/list:
    post:
      tags:
        - Google (Drive/Docs)
      summary: Listar Arquivos do Drive
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                wa_id: { type: string }
                query: { type: string }
      responses:
        '200': { description: Lista de arquivos }

  /docs/create:
    post:
      tags:
        - Google (Drive/Docs)
      summary: Criar Documento Google Doc
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                wa_id: { type: string }
                title: { type: string }
                content: { type: string }
      responses:
        '200': { description: Doc criado com link }

  /sheets/create:
    post:
      tags:
        - Google (Drive/Docs)
      summary: Criar Planilha Google Sheets
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                wa_id: { type: string }
                title: { type: string }
      responses:
        '200': { description: Planilha criada com link }